<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Android自动更新,支持增量更新 | Weiye&#39;s Blog | 好好学习,天天向上</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Android">
    <meta name="description" content="APP自动增量更新github：https://github.com/itlwy/AppSmartUpdate 抽取的Android自动更新库,目的是几行代码引入更新功能,含服务端代码,欢迎Star，欢迎Fork，谢谢～ 目录 功能介绍 流程图 效果图与示例apk 如何引入 更新清单文件 简单使用 详细说明 差分包生成(服务端) 依赖 License  功能介绍  支持全量更新apk,直接升级到最">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android自动更新,支持增量更新">
<meta property="og:url" content="http://yoursite.com/2018/09/04/Android增量自动更新/index.html">
<meta property="og:site_name" content="Weiye&#39;s Blog">
<meta property="og:description" content="APP自动增量更新github：https://github.com/itlwy/AppSmartUpdate 抽取的Android自动更新库,目的是几行代码引入更新功能,含服务端代码,欢迎Star，欢迎Fork，谢谢～ 目录 功能介绍 流程图 效果图与示例apk 如何引入 更新清单文件 简单使用 详细说明 差分包生成(服务端) 依赖 License  功能介绍  支持全量更新apk,直接升级到最">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/flowchart.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/update_1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/update_2.png">
<meta property="og:updated_time" content="2020-09-30T13:33:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android自动更新,支持增量更新">
<meta name="twitter:description" content="APP自动增量更新github：https://github.com/itlwy/AppSmartUpdate 抽取的Android自动更新库,目的是几行代码引入更新功能,含服务端代码,欢迎Star，欢迎Fork，谢谢～ 目录 功能介绍 流程图 效果图与示例apk 如何引入 更新清单文件 简单使用 详细说明 差分包生成(服务端) 依赖 License  功能介绍  支持全量更新apk,直接升级到最">
<meta name="twitter:image" content="https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/flowchart.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="Weiye&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Weiye Lee</h5>
          <a href="mailto:9011532@qq.com" title="9011532@qq.com" class="mail">9011532@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/itlwy" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://blog.csdn.net/Weiye__Lee" target="_blank" >
                <i class="icon icon-lg icon-link"></i>
                CSDN
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.jianshu.com/u/889c25a46410" target="_blank" >
                <i class="icon icon-lg icon-book"></i>
                简书
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Android自动更新,支持增量更新</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Android自动更新,支持增量更新</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-09-04T12:00:30.000Z" itemprop="datePublished" class="page-time">
  2018-09-04
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#APP自动增量更新"><span class="post-toc-number">1.</span> <span class="post-toc-text">APP自动增量更新</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#目录"><span class="post-toc-number">2.</span> <span class="post-toc-text">目录</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#功能介绍"><span class="post-toc-number">3.</span> <span class="post-toc-text">功能介绍</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#流程图"><span class="post-toc-number">4.</span> <span class="post-toc-text">流程图</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#效果图与示例apk"><span class="post-toc-number">5.</span> <span class="post-toc-text">效果图与示例apk</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#如何引入"><span class="post-toc-number">6.</span> <span class="post-toc-text">如何引入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gradle引入"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">Gradle引入</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#step-1"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">step 1</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-2"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">Step 2</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#更新清单文件"><span class="post-toc-number">7.</span> <span class="post-toc-text">更新清单文件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简单使用"><span class="post-toc-number">8.</span> <span class="post-toc-text">简单使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-初始化"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">1.初始化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-调用"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">2.调用</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#详细说明"><span class="post-toc-number">9.</span> <span class="post-toc-text">详细说明</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#注册通知回调"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">注册通知回调</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#网络框架注入"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">网络框架注入</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#定制更新交互界面"><span class="post-toc-number">9.3.</span> <span class="post-toc-text">定制更新交互界面</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#差分包合成-jni"><span class="post-toc-number">9.4.</span> <span class="post-toc-text">差分包合成(jni)</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#差分包生成"><span class="post-toc-number">10.</span> <span class="post-toc-text">差分包生成</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#依赖"><span class="post-toc-number">11.</span> <span class="post-toc-text">依赖</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#License"><span class="post-toc-number">12.</span> <span class="post-toc-text">License</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Android增量自动更新"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Android自动更新,支持增量更新</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-09-04 20:00:30" datetime="2018-09-04T12:00:30.000Z"  itemprop="datePublished">2018-09-04</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="APP自动增量更新"><a href="#APP自动增量更新" class="headerlink" title="APP自动增量更新"></a>APP自动增量更新</h2><p><a href="https://github.com/itlwy/AppSmartUpdate" target="_blank" rel="noopener">github：https://github.com/itlwy/AppSmartUpdate</a></p>
<p>抽取的Android自动更新库,目的是几行代码引入更新功能,含服务端代码,欢迎Star，欢迎Fork，谢谢～</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li><a href="#功能介绍">功能介绍</a></li>
<li><a href="#流程图">流程图</a></li>
<li><a href="#效果图与示例apk">效果图与示例apk</a></li>
<li><a href="#如何引入">如何引入</a></li>
<li><a href="#更新清单文件">更新清单文件</a></li>
<li><a href="#简单使用">简单使用</a></li>
<li><a href="#详细说明">详细说明</a></li>
<li><a href="#差分包生成">差分包生成(服务端)</a></li>
<li><a href="#依赖">依赖</a></li>
<li><a href="#License">License</a></li>
</ul>
<h2 id="功能介绍"><a href="#功能介绍" class="headerlink" title="功能介绍"></a>功能介绍</h2><ul>
<li style="list-style: none"><input type="checkbox" checked> 支持全量更新apk,直接升级到最新版本</li>
<li style="list-style: none"><input type="checkbox" checked> 支持增量更新,只下载补丁包升级</li>
<li style="list-style: none"><input type="checkbox" checked> 设置仅在wifi环境下更新</li>
<li style="list-style: none"><input type="checkbox" checked> 支持外部注入网络框架(库默认使用okhttp)</li>
<li style="list-style: none"><input type="checkbox" checked> 支持前台和后台自动更新</li>
<li style="list-style: none"><input type="checkbox" checked> 支持强制更新</li>
<li style="list-style: none"><input type="checkbox" checked> 支持对外定制更新提示和更新进度界面</li>
<li style="list-style: none"><input type="checkbox"> 记忆下载</li>
<li style="list-style: none"><input type="checkbox" checked> 含发布功能后台服务端<a href="https://github.com/itlwy/App-Update-Server" target="_blank" rel="noopener">github</a> (Node.js实现)</li>
</ul>
<h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><p><img src="https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/flowchart.jpg" width="80%" height="50%"></p>
<h2 id="效果图与示例apk"><a href="#效果图与示例apk" class="headerlink" title="效果图与示例apk"></a>效果图与示例apk</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/update_1.png" alt="示例1" title>
                </div>
                <div class="image-caption">示例1</div>
            </figure> 
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/update_2.png" alt="示例2" title>
                </div>
                <div class="image-caption">示例2</div>
            </figure>
<p><a href="https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/app/v100/smart-updatev100.apk" target="_blank" rel="noopener">点击下载 smart-update.apk</a> </p>
<h2 id="如何引入"><a href="#如何引入" class="headerlink" title="如何引入"></a>如何引入</h2><h3 id="Gradle引入"><a href="#Gradle引入" class="headerlink" title="Gradle引入"></a>Gradle引入</h3><h3 id="step-1"><a href="#step-1" class="headerlink" title="step 1"></a>step 1</h3><p>Add the JitPack repository to your build file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">		repositories &#123;</span><br><span class="line">			...</span><br><span class="line">			maven &#123; url &apos;https://jitpack.io&apos; &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>Add the dependency</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	          implementation &apos;com.github.itlwy:AppSmartUpdate:v1.0.6&apos;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="更新清单文件"><a href="#更新清单文件" class="headerlink" title="更新清单文件"></a>更新清单文件</h2><p>该清单放置在静态服务器以供App访问，主要用于判断最新的版本，及要更新的版本资源信息等(示例见仓库根目录下的resources目录或直接访问后台代码 <a href="https://github.com/itlwy/App-Update-Server" target="_blank" rel="noopener">github</a>)，清单由服务端程序发布apk时生成，详见后台示例:<a href="https://github.com/itlwy/App-Update-Server" target="_blank" rel="noopener">github</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"minVersion"</span>: <span class="number">100</span>, <span class="comment">// app最低支持的版本代码(包含),低于此数值的app将强制更新</span></span><br><span class="line">  <span class="attr">"minAllowPatchVersion"</span>: <span class="number">100</span>, <span class="comment">// 最低支持的差分版本(包含),低于此数值的app将采取全量更新,否则采用差量</span></span><br><span class="line">  <span class="attr">"newVersion"</span>: <span class="number">101</span>, <span class="comment">// 当前最新版本代码</span></span><br><span class="line">  <span class="attr">"tip"</span>: <span class="string">"test update"</span>,	<span class="comment">// 更新提示</span></span><br><span class="line">  <span class="attr">"size"</span>: <span class="number">1956631</span>,	<span class="comment">// 最新apk文件大小</span></span><br><span class="line">  <span class="attr">"apkURL"</span>: <span class="string">"https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/app/smart-update.apk"</span>, <span class="comment">// 最新apk 绝对url地址，也可用相对地址，如下方的"patchURL"字段</span></span><br><span class="line">  <span class="attr">"hash"</span>: <span class="string">"ea97c8efa490a2eaf7d10b37e63dab0e"</span>, <span class="comment">// 最新apk文件的md5值</span></span><br><span class="line">  <span class="attr">"patchInfo"</span>: &#123;  <span class="comment">// 差分包信息</span></span><br><span class="line">    <span class="attr">"v100"</span>: &#123; <span class="comment">// v100表示-版本代码100的apk需要下载的差分包</span></span><br><span class="line">      <span class="attr">"patchURL"</span>: <span class="string">"v100/100to101.patch"</span>, <span class="comment">//差分包地址，相对此UpdateManifest.json文件的地址,也可用绝对地址</span></span><br><span class="line">      <span class="attr">"tip"</span>: <span class="string">"101 version"</span>, <span class="comment">// 提示</span></span><br><span class="line">      <span class="attr">"hash"</span>: <span class="string">"ea97c8efa490a2eaf7d10b37e63dab0e"</span>, <span class="comment">// 合成后apk(即版本代码101)的文件md5值</span></span><br><span class="line">      <span class="attr">"size"</span>: <span class="number">1114810</span> <span class="comment">// 差分包大小</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><h3 id="1-初始化"><a href="#1-初始化" class="headerlink" title="1.初始化"></a>1.初始化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="comment">//推荐在Application中初始化</span></span><br><span class="line">        Config config = <span class="keyword">new</span> Config.Builder()</span><br><span class="line">                .isDebug(<span class="keyword">true</span>)</span><br><span class="line">                .build(<span class="keyword">this</span>);</span><br><span class="line">        UpdateManager.getInstance().init(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-调用"><a href="#2-调用" class="headerlink" title="2.调用"></a>2.调用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"> <span class="keyword">private</span> Button mUpdateBtn;</span><br><span class="line">    <span class="keyword">private</span> String manifestJsonUrl = <span class="string">"https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/UpdateManifest.json"</span>;</span><br><span class="line">    <span class="keyword">private</span> IUpdateCallback mCallback;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        mUpdateBtn = (Button) findViewById(R.id.update_btn);</span><br><span class="line">        mUpdateBtn.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.update_btn:</span><br><span class="line">                UpdateManager.getInstance().update(<span class="keyword">this</span>, manifestJsonUrl, <span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="详细说明"><a href="#详细说明" class="headerlink" title="详细说明"></a>详细说明</h2><h3 id="注册通知回调"><a href="#注册通知回调" class="headerlink" title="注册通知回调"></a>注册通知回调</h3><ul>
<li>其他activity界面需要获知后台更新情况</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(IUpdateCallback callback)</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unRegister</span><span class="params">(IUpdateCallback callback)</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUpdateCallback</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通知无新版本需要更新,运行在主线程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">noNewApp</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动更新准备开始时回调,运行在主线程，可做一些提示等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">beforeUpdate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动更新的进度回调（分增量和全量更新）,运行在主线程</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> percent     当前总进度百分比</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> totalLength 更新总大小(全量为apk大小,增量为全部补丁大小和)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> patchIndex  当前更新的补丁索引(从1开始)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> patchCount  需要更新的总补丁数(当为0时表示是增量更新)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onProgress</span><span class="params">(<span class="keyword">int</span> percent, <span class="keyword">long</span> totalLength, <span class="keyword">int</span> patchIndex, <span class="keyword">int</span> patchCount)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载完成，准备更新,运行在主线程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常回调,运行在主线程</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> error 异常信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onError</span><span class="params">(String error)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户取消了询问更新对话框</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCancelUpdate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 取消了更新进度对话框,压入后台自动更新,此时由通知栏通知进度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onBackgroundTrigger</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="网络框架注入"><a href="#网络框架注入" class="headerlink" title="网络框架注入"></a>网络框架注入</h3><p>默认使用okhttp，也可由外部注入,只需实现如下的IHttpManager接口,然后通过new Config.Builder().httpManager(new OkhttpManager())注入即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IHttpManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function">IResponse <span class="title">syncGet</span><span class="params">(@NonNull String url, @NonNull Map&lt;String, String&gt; params)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异步get</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url      get请求地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params   get参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> callBack 回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">asyncGet</span><span class="params">(@NonNull String url, @NonNull Map&lt;String, String&gt; params, @NonNull Callback callBack)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异步post</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url      post请求地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params   post请求参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> callBack 回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">asyncPost</span><span class="params">(@NonNull String url, @NonNull Map&lt;String, String&gt; params, @NonNull Callback callBack)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url      下载地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path     文件保存路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> callback 回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">download</span><span class="params">(@NonNull String url, @NonNull String path, @NonNull String fileName, @NonNull FileCallback callback)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定制更新交互界面"><a href="#定制更新交互界面" class="headerlink" title="定制更新交互界面"></a>定制更新交互界面</h3><p>每个应用的风格都可能是不一样的，因此这里也支持自定义弹出的提示框和进度框，详细见如下代码示例：</p>
<ol>
<li><p>初始化config时需要将内部默认的弹框屏蔽掉</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">         Config config = <span class="keyword">new</span> Config.Builder()</span><br><span class="line">                .isShowInternalDialog(<span class="keyword">false</span>)</span><br><span class="line">                .build(<span class="keyword">this</span>);</span><br><span class="line">        UpdateManager.getInstance().init(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义对话框，如下(详细代码在MainActivity.java里)：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerUpdateCallbak</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       mCallback = <span class="keyword">new</span> IUpdateCallback() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">noNewApp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"当前已是最新版本!"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hasNewApp</span><span class="params">(AppUpdateModel appUpdateModel, UpdateManager updateManager, <span class="keyword">final</span> <span class="keyword">int</span> updateMethod)</span> </span>&#123;</span><br><span class="line">               AlertDialog.Builder builder = <span class="keyword">new</span> AlertDialog.Builder(MainActivity.<span class="keyword">this</span>);</span><br><span class="line">               mDialog = builder.setTitle(<span class="string">"自动更新提示"</span>)</span><br><span class="line">                       .setMessage(appUpdateModel.getTip())</span><br><span class="line">                       .setPositiveButton(<span class="string">"更新"</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                           <span class="meta">@Override</span></span><br><span class="line">                           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                               UpdateManager.getInstance().startUpdate(updateMethod);</span><br><span class="line">                           &#125;</span><br><span class="line">                       &#125;)</span><br><span class="line">                       .setNegativeButton(<span class="string">"取消"</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                           <span class="meta">@Override</span></span><br><span class="line">                           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                           &#125;</span><br><span class="line">                       &#125;).create();</span><br><span class="line">               mDialog.show();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="comment">// 更新开始</span></span><br><span class="line">               mProgressDialog = <span class="keyword">new</span> ProgressDialog(MainActivity.<span class="keyword">this</span>);</span><br><span class="line">               mProgressDialog.setTitle(<span class="string">"更新中..."</span>);</span><br><span class="line">               mProgressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);</span><br><span class="line">               mProgressDialog.setMessage(<span class="string">"正在玩命更新中..."</span>);</span><br><span class="line">               mProgressDialog.setMax(<span class="number">100</span>);</span><br><span class="line">               mProgressDialog.setProgress(<span class="number">0</span>);</span><br><span class="line">               mProgressDialog.setOnCancelListener(<span class="keyword">new</span> DialogInterface.OnCancelListener() &#123;</span><br><span class="line">                   <span class="meta">@Override</span></span><br><span class="line">                   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCancel</span><span class="params">(DialogInterface dialog)</span> </span>&#123;</span><br><span class="line">                       <span class="comment">// 退到后台自动更新，进度由通知栏显示</span></span><br><span class="line">                       <span class="keyword">if</span> (UpdateManager.getInstance().isRunning()) &#123;</span><br><span class="line">                           UpdateManager.getInstance().onBackgroundTrigger();</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;);</span><br><span class="line">               mProgressDialog.show();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgress</span><span class="params">(<span class="keyword">int</span> percent, <span class="keyword">long</span> totalLength, <span class="keyword">int</span> patchIndex, <span class="keyword">int</span> patchCount)</span> </span>&#123;</span><br><span class="line">               String tip;</span><br><span class="line">               <span class="keyword">if</span> (patchCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                   tip = String.format(<span class="string">"正在下载补丁%d/%d"</span>, patchIndex, patchCount);</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   tip = <span class="string">"正在下载更新中..."</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               mProgressDialog.setProgress(percent);</span><br><span class="line">               mProgressDialog.setMessage(tip);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               mProgressDialog.dismiss();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(String error)</span> </span>&#123;</span><br><span class="line">               Toast.makeText(MainActivity.<span class="keyword">this</span>, error, Toast.LENGTH_LONG).show();</span><br><span class="line">               mProgressDialog.dismiss();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCancelUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackgroundTrigger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"转为后台更新，进度由通知栏提示!"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">       UpdateManager.getInstance().register(mCallback);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="差分包合成-jni"><a href="#差分包合成-jni" class="headerlink" title="差分包合成(jni)"></a>差分包合成(jni)</h3><p>​    此部分采用的差分工具为开源<a href="http://www.daemonology.net/bsdiff/" target="_blank" rel="noopener">bsdiff</a>，用于生成.patch补丁文件，采用jni方式封装一个.so库供java调用，详见”smartupdate”库里的main/cpp目录源码，过程比较简单，就是写个jni的方法来直接调用bsdiff库，目录结构如下：</p>
<p>main</p>
<pre><code>-cpp

    -bzip2

    -CMakeLists.txt

    -patchUtils.c

    -patchUtils.h

    -update-lib.cpp
</code></pre><p>​    因为bsdiff还依赖了bzip2，所以这里涉及多个源文件编译链接问题，需要在CMakeLists.txt稍作修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 将当前 &quot;./src/main/cpp&quot; 目录下的所有源文件保存到 &quot;NATIVE_SRC&quot; 中，然后在 add_library 方法调用。</span><br><span class="line">aux_source_directory( . NATIVE_SRC )</span><br><span class="line"># 将 &quot;./src/main/cpp/bzip2&quot; 目录下的子目录bzip2保存到 &quot;BZIP2_BASE&quot; 中，然后在 add_library 方法调用。</span><br><span class="line">aux_source_directory( ./bzip2 BZIP2_BASE )</span><br><span class="line"># 将 BZIP2_BASE 增加到 NATIVE_SRC 中，这样目录的源文件也加入了编译列表中，当然也可以不加到 NATIVE_SRC，直接调用add_library。</span><br><span class="line">list(APPEND NATIVE_SRC $&#123;BZIP2_BASE&#125;)</span><br><span class="line"></span><br><span class="line">add_library( # Sets the name of the library.</span><br><span class="line">        update-lib</span><br><span class="line">        # Sets the library as a shared library.</span><br><span class="line">        SHARED</span><br><span class="line">        # Provides a relative path to your source file(s).</span><br><span class="line">        $&#123;NATIVE_SRC&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="差分包生成"><a href="#差分包生成" class="headerlink" title="差分包生成"></a>差分包生成</h2><p>​    服务端见<a href="https://github.com/itlwy/App-Update-Server" target="_blank" rel="noopener">github</a> ，使用时将manifestJsonUrl改成部署的服务器地址即可，如下示例代码片段的注释处</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String manifestJsonUrl = <span class="string">"https://raw.githubusercontent.com/itlwy/AppSmartUpdate/master/resources/UpdateManifest.json"</span>;</span><br><span class="line"><span class="comment">//    private String manifestJsonUrl = "http://192.168.2.107:8000/app/UpdateManifest.json";</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><ul>
<li>okhttp : com.squareup.okhttp3:okhttp:3.11.0</li>
<li>gson : com.google.code.gson:gson:2.8.0</li>
<li>numberprogressbar : com.daimajia.numberprogressbar:library:1.4@aar</li>
</ul>
<h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><pre><code>   Copyright 2018 lwy

Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</code></pre>
        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-09-30T13:33:34.000Z" itemprop="dateUpdated">2020-09-30 21:33:34</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2018/09/04/Android增量自动更新/" target="_blank" rel="external">http://yoursite.com/2018/09/04/Android增量自动更新/</a>
        
    </div>
    
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/avatar.jpg" alt="Weiye Lee">
            Weiye Lee
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2018/09/04/Android增量自动更新/&title=《Android自动更新,支持增量更新》 — Weiye's Blog&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2018/09/04/Android增量自动更新/&title=《Android自动更新,支持增量更新》 — Weiye's Blog&source=好好学习,天天向上" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2018/09/04/Android增量自动更新/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android自动更新,支持增量更新》 — Weiye's Blog&url=http://yoursite.com/2018/09/04/Android增量自动更新/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2018/09/04/Android增量自动更新/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/05/15/Android轻量级网页风格分页器/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Android轻量级网页风格分页器</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/08/24/DataBinding_View绑定库/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">基于DataBinding的基础View绑定库</h4>
      </a>
    </div>
  
</nav>



    




















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Weiye Lee &copy; 2015 - 2022</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2018/09/04/Android增量自动更新/&title=《Android自动更新,支持增量更新》 — Weiye's Blog&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2018/09/04/Android增量自动更新/&title=《Android自动更新,支持增量更新》 — Weiye's Blog&source=好好学习,天天向上" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2018/09/04/Android增量自动更新/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android自动更新,支持增量更新》 — Weiye's Blog&url=http://yoursite.com/2018/09/04/Android增量自动更新/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2018/09/04/Android增量自动更新/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACI0lEQVR42u3aS3LDIBAFQN//0soBEuQ3DEqVoFmpbBloLWTm8/nE4/o1Rt+O7h99ez/P4oGBgfFaxnU75u7pz5zPgIGBcQ5j9AYbXY+WzGdO5kn2hoGBgXHPSA6Iya+SdTEwMDByxn0UmXyeUzEwMDCqoWb1upo++6dYHAMD44WMfIH/v36kvoGBgfEqxlUcnbrhXCIv2hUGBsbWjGqAmoeXa4PeaBUMDIxNGdXFOg1hc4fCqJyAgYGxNaPTALEqlZY8jkIzBwYGxnaMJFjNW0tXHQ2Tef7438DAwDiA0WmD6DSh5uFx9F+BgYGxKSP/5LmAtlXOxMDAOICRp7TKr8LiPMnxNApiMTAwNmIkr85+on8urM1DawwMjBMYeXoreaXmx8dqM1mUzsPAwNiOMVcMqB7m+kWF6FCIgYGxKaO6uX6IW8UUekYwMDAOYzwR0CaFz2phAAMD4xzGquJlJySubv1Lug0DA2M7xtzhrNoSkYfKeRjcOntiYGC8kPEJRifdVm6eqGIwMDAOZpTTXnH7RZ7aWxyLY2BgvJbRad6aKypUtx5F4RgYGNsxruJY9uSmgtvhaxoDA2Nrxty2qgXITmKueiTFwMDYlTHXQpEXDO4LmfnL+ssjwMDAOIDxXLCazNwpTmBgYGAkpOoJdG42DAwMjKdj4qTtrPVbDAyMAxhJELsqiT930PxyPwYGxtaMVug4tUC1sbVTZsDAwHg54wdg5g3L9ZwWVgAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
